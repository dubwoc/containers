FROM debian:wheezy
ENV DEBIAN_FRONTEND noninteractive
ENV LANG en_US.UTF-8
ENV LC_ALL C.UTF-8
ENV LANGUAGE en_US.UTF-8

RUN apt-get update -y && apt-get dist-upgrade -y
RUN apt-get install -y apache2
ADD pkgs/ /pkgs
RUN dpkg -i /pkgs/openssl_1.0.1e-2_amd64.deb
RUN dpkg -i /pkgs/libssl1.0.0_1.0.1e-2_amd64.deb

# Setup vulnerable web server and enable SSL based Apache instance
ADD index.html /var/www/
RUN sed -i 's/^NameVirtualHost/#NameVirtualHost/g' /etc/apache2/ports.conf
RUN sed -i 's/^Listen/#Listen/g' /etc/apache2/ports.conf
RUN a2enmod ssl
RUN a2dissite default
RUN a2ensite default-ssl

# Clean up
RUN apt-get autoremove
RUN apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

# Expose the port for usage with the docker -P switch
EXPOSE 443

# Run Apache 2
CMD ["/usr/sbin/apache2ctl", "-DFOREGROUND"]
